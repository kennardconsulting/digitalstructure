(function(){"use strict";var e=angular.module("app",["controllers","metawidget"]);e.config(["$routeProvider",function(e){e.when("/login",{templateUrl:"partials/login.html",controller:"loginController"}).when("/home",{templateUrl:"partials/home.html",controller:"homeController"}).when("/edit/:pathName/:methodName/:id",{templateUrl:"partials/crud.html",controller:"entityController"}).when("/new/:pathName/:methodName",{templateUrl:"partials/crud.html",controller:"entityController"}).when("/search/:pathName/:methodName",{templateUrl:"partials/search.html",controller:"entitiesController"}).otherwise({redirectTo:"/home"})}]),e.factory("visualHttp",["$http","$rootScope",function(e,t){return e.defaults.transformRequest.push(function(e){return t.duringAjax=!0,e}),e.defaults.transformResponse.push(function(e){return delete t.duringAjax,e}),e}])})(),function(){"use strict";function e(e,t,o){return e({method:"POST",url:t,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var o in e)"string"==typeof e[o]&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},data:o})}var t="https://site1567.1blankspacebeta.com",o=angular.module("controllers",[]);o.controller("loginController",["$rootScope","$scope","visualHttp","$location",function(o,r,a,n){delete o.sid,r.metawidgetConfig={addWidgetProcessors:[new metawidget.bootstrap.widgetprocessor.BootstrapWidgetProcessor],layout:new metawidget.bootstrap.layout.BootstrapDivLayout},r.login={logon:"",password:"",signIn:function(){e(a,t+"/rpc/logon/",r.login).success(function(e){void 0!==e.error?(r.error=e.error.errornotes,console.log(r.error)):(delete r.error,o.sid=e.sid,n.path("/home"))}).error(function(e){r.error=e})}}}]),o.controller("homeController",["$rootScope","$location",function(e,t){return void 0===e.sid?(console.log("Not logged in"),t.path("/login"),void 0):void 0}]),o.controller("entitiesController",["$rootScope","$scope","$routeParams","visualHttp","$location",function(e,o,r,a,n){if(void 0===e.sid)return console.log("Not logged in"),n.path("/login"),void 0;o.routeParams={pathName:r.pathName,methodName:r.methodName},o.search=function(){a.get(t+"/rpc/"+r.pathName+"/?method="+r.methodName+"_SEARCH&sid="+e.sid).then(function(e){o.results=e.data.data.rows,console.log("Searched")})},o.search();var d=new metawidget.widgetbuilder.HtmlWidgetBuilder,i=d.addColumn;d.addColumn=function(e,t,o){var a=i(e,t,o),n=document.createElement("a");n.setAttribute("href","#/edit/"+r.pathName+"/"+r.methodName+"/"+t.id),n.innerHTML=a.innerHTML,a.innerHTML="",a.appendChild(n)},o.metawidgetConfig={widgetBuilder:new metawidget.widgetbuilder.CompositeWidgetBuilder([new metawidget.widgetbuilder.OverriddenWidgetBuilder,new metawidget.widgetbuilder.ReadOnlyWidgetBuilder,d]),addWidgetProcessors:[new metawidget.bootstrap.widgetprocessor.BootstrapWidgetProcessor],layout:new metawidget.layout.SimpleLayout}}]),o.controller("entityController",["$rootScope","$scope","$routeParams","visualHttp","$location",function(e,o,r,a,n){return void 0===e.sid?(console.log("Not logged in"),n.path("/login"),void 0):(o.routeParams={pathName:r.pathName},void 0===r.id?o.current={}:a.post(t+"/rpc/"+r.pathName+"/?method="+r.methodName+"_SEARCH&sid="+e.sid+"&advanced=1",{filters:[{name:"id",comparison:"EQUAL_TO",value1:r.id}],fields:[{name:"*"}]}).then(function(e){o.current={};for(var t in e.data.data.rows[0]){var r=t;-1!==r.lastIndexOf(".")&&(r=r.substr(r.lastIndexOf(".")+1)),o.current[r]=e.data.data.rows[0][t]}o.readOnly=!0}),o.metawidgetConfig={addInspectionResultProcessors:[function(o,n,d,i,s){function l(o){for(var r in o.properties){var d=o.properties[r];if(void 0!==d.needEnum)return console.log(r+" needs "+d.needEnum),a.get(t+"/ondemand/setup/?method="+d.needEnum+"&sid="+e.sid,{}).then(function(e){delete d.needEnum;var t=[],r=[];if(e.data.data)for(var a=0,n=e.data.data.rows.length;n>a;a++)t.push(e.data.data.rows[a].id),r.push(e.data.data.rows[a].title);d.enum=t,d.enumTitles=r,l(o)}),void 0}console.log("Retrieved metadata"),n.buildWidgets(o)}void 0===s&&a.post(t+"/rpc/"+r.pathName+"/?method="+r.methodName+"_SEARCH&advanced=1&sid="+e.sid,{options:{rf:"JSON",returnparameters:"contactperson"}}).then(function(e){var t={};t.properties={};for(var o=e.data.data.parameters,r=0,a=o.length;a>r;r++){var n=o[r],d=n.name;-1!==d.lastIndexOf(".")&&(d=d.substr(d.lastIndexOf(".")+1)),"select"===n.inputtype&&(d=d.substr(0,d.lastIndexOf("text")));var i=t.properties[d]||{};t.properties[d]=i,i.propertyOrder=r,i.type="date"===n.datatype?"date":"string","select"===n.inputtype&&(i.needEnum=n.searchmethod)}l(t)})}],addWidgetProcessors:[new metawidget.bootstrap.widgetprocessor.BootstrapWidgetProcessor],layout:new metawidget.bootstrap.layout.BootstrapDivLayout},o.actions={edit:function(){o.readOnly=!1},save:function(){a.post(t+"/rpc/"+r.pathName+"/?method="+r.methodName+"_MANAGE&sid="+e.sid,o.current).then(function(e){void 0!==e.data.error?o.error=e.data.error.errornotes:(delete o.error,o.current.id=e.data.id,console.log(e.data.notes+" with id "+o.current.id),n.path("/search/"+r.pathName+"/"+r.methodName))})},"delete":function(){a.post(t+"/rpc/"+r.pathName+"/?method="+r.methodName+"_MANAGE&sid="+e.sid,{id:o.current.id,remove:1}).then(function(e){console.log(e.data.notes+" id "+o.current.id)}),n.path("/search/"+r.pathName+"/"+r.methodName)},cancel:function(){n.path("/search/"+r.pathName+"/"+r.methodName)}},o.metawidgetActionsConfig={inspector:new metawidget.inspector.CompositeInspector([new metawidget.inspector.PropertyTypeInspector,function(){return{properties:{edit:{hidden:"{{!readOnly}}"},save:{hidden:"{{readOnly}}"},"delete":{hidden:"{{readOnly || !current.id}}"}}}}]),addWidgetProcessors:[new metawidget.bootstrap.widgetprocessor.BootstrapWidgetProcessor],layout:new metawidget.layout.SimpleLayout},void 0)}])}();